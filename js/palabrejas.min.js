(function(e){var d={init:function(f){var h=e(this),g={tile_w:20,tile_h:30,NUMERAL_COUNT:1,SELECT_MODE:0,ALPHABET:new RegExp(/[\w√ë]/),GO_NEXT:false,GO_BACK:false,cluesContainer:e("#clues"),labelHorClues:"Horizontales",labelVerClues:"Verticales",onError:function(j,i,k){alert("Error!\n"+j+"\n"+i+"\n"+k);console.log(j,i,k)},onTimeout:function(){alert("Timeout!\n"+a+"\n"+b+"\n"+c);console.log(a,b,c)},linkVerify:e("#btnVerify")};e.fn.extend(g,f);e.ajax({url:g.url,type:"GET",dataType:"json",cache:false,async:true,contentType:"application/json; charset=utf-8",success:function(i){g.tiles=i.tiles;g.clues=i.clues;g.id=i.id;h.data("options",g);h.palabrejas("create")},error:g.onError,timeout:g.onTimeout})},create:function(){var k=0,h,m=e(this),p=m.data("options"),o=p.tiles.length,l,n,g,f;for(;k<o;k++){n=p.tiles[k].length;for(h=0;h<n;h++){f=e.trim(p.tiles[k][h])=="";l=m.palabrejas("createTile",h,k,f);m.append(l);if(!f){g=m.palabrejas("setNumeral",h,k);if(g!=-1){l.append("<span class='numeral'>"+g+"</span>")}}}}m.css({width:(n*p.tile_w)+"px",height:(o*p.tile_h)+"px"});m.palabrejas("addClues");m.palabrejas("addEvents")},addClues:function(){var l=0,n=e(this),k=n.data("options"),g=k.clues[0].length,m,f,h=e("<div class='clue-container'><ul id='hor-clues'></ul></div>"),j=e("<div class='clue-container'><ul id='ver-clues'></ul></div>");h.prepend("<h3>"+k.labelHorClues+"</h3>");for(;l<g;l++){m=k.clues[0][l];f=e("<li><span>"+m.numeral+"</span>"+m.clue+"</li>");m.elem=f;h.find("ul").append(f)}l=0;g=k.clues[1].length;j.prepend("<h3>"+k.labelVerClues+"</h3>");for(;l<g;l++){m=k.clues[1][l];f=e("<li><span>"+m.numeral+"</span>"+m.clue+"</li>");m.elem=f;j.find("ul").append(f)}k.cluesContainer.append(h).append(j)},setNumeral:function(f,n){var g=0,j,m=e(this),h=m.data("options"),l;for(;g<2;g++){len=h.clues[g].length;for(j=0;j<len;j++){l=h.clues[g][j];if(l.x==f&&l.y==n){l.numeral=h.NUMERAL_COUNT++;return l.numeral}}}return -1},createTile:function(h,f,i){var j=e(this),g=j.data("options");width=g.tile_w-2,height=g.tile_h-2,left=h*g.tile_w,tp=f*g.tile_h,tile=e("<span class='tile'></span>").css({width:width,height:height,top:tp,left:left});if(i){tile.addClass("void")}else{tile.append("<input type='text' maxlength='1' size='1' />");tile.click(function(k){j.palabrejas("tileClicked",k,e(this))});tile.data("pos",{x:parseInt(h,10),y:parseInt(f,10)})}return tile},addEvents:function(f){var k=e(this),g=k.data("options"),m,h,j,l,i;console.log(g.linkVerify);g.linkVerify.click(function(n){j="";e(".tile").each(function(){i=e(this);if(i.hasClass("void")){j=j+"#"}else{l=((i.find("input").val()=="")?" ":i.find("input").val());j=j+l.toUpperCase()}});console.log(j);e.ajax({url:g.verify,type:"GET",dataType:"json",cache:false,async:true,contentType:"application/json; charset=utf-8",data:{data:j},success:function(o){if(o.correct=="true"){alert("Correcto!!!")}else{if(o.correct=="false"){alert("INcorrecto!!!")}}},error:g.onError,timeout:g.onTimeout})});e(".tile input").keydown(function(n){var o;if(window.event){o=n.keyCode}else{if(n.which){o=n.which}}if(o==8){if(e(this).val()==""){g.GO_BACK=true}return true}if(g.ALPHABET.test(String.fromCharCode(o))){g.GO_NEXT=true;return true}return false}).keyup(function(n){if(g.GO_NEXT){m=e(this).parent(".tile").data("pos");if(g.SELECT_MODE==0){h=k.palabrejas("getTile",(m.x+1),m.y)}else{h=k.palabrejas("getTile",m.x,(m.y+1))}if(h!=null){h.click();h.find("input").focus()}g.GO_NEXT=false}if(g.GO_BACK){m=e(this).parent(".tile").data("pos");if(g.SELECT_MODE==0){h=k.palabrejas("getTile",(m.x-1),m.y)}else{h=k.palabrejas("getTile",m.x,(m.y-1))}if(h!=null){h.click();h.find("input").focus()}g.GO_BACK=false}}).on("selectstart",false)},tileClicked:function(i,g){var h=e(this),f=h.data("options"),j;if(g.hasClass("selected")){if(h.palabrejas("hasAdjacent",g,true)){if(f.SELECT_MODE==0){f.SELECT_MODE=1}else{f.SELECT_MODE=0}}}else{if(!h.palabrejas("hasAdjacent",g,false)){if(f.SELECT_MODE==0){f.SELECT_MODE=1}else{f.SELECT_MODE=0}}}e(".tile").removeClass("selected").removeClass("shadowed");g.addClass("selected");j=h.palabrejas("getInitTile",g);h.palabrejas("shadow",j);h.palabrejas("highlightClue",j)},getInitTile:function(h){var i=e(this),f=i.data("options"),j=h.data("pos"),g;if(f.SELECT_MODE==0){if(j.x==0){return h}else{if(j.x>0){g=i.palabrejas("getTile",(j.x-1),j.y);while(g!=null){j=g.data("pos");h=g;g=i.palabrejas("getTile",(j.x-1),j.y)}return h}}}else{if(j.y==0){return h}else{if(j.y>0){g=i.palabrejas("getTile",j.x,(j.y-1));while(g!=null){j=g.data("pos");h=g;g=i.palabrejas("getTile",j.x,(j.y-1))}return h}}}},highlightClue:function(j){var l=e(this),g=l.data("options"),h=0,f=g.clues[g.SELECT_MODE].length,k,m=j.data("pos");for(;h<f;h++){k=g.clues[g.SELECT_MODE][h];if(m.x==k.x&&m.y==k.y){e("#clues ul li").removeClass("highlighted");k.elem.addClass("highlighted");break}}},shadow:function(g){var i=e(this),f=i.data("options"),j=g.data("pos"),h;if(f.SELECT_MODE==0){h=i.palabrejas("getTile",(j.x+1),j.y);while(h!=null){g.addClass("shadowed");g=h;j=g.data("pos");h=i.palabrejas("getTile",(j.x+1),j.y)}g.addClass("shadowed")}else{g.addClass("shadowed");h=i.palabrejas("getTile",j.x,(j.y+1));while(h!=null){h.addClass("shadowed");g=h;j=g.data("pos");h=i.palabrejas("getTile",j.x,(j.y+1))}}},getTile:function(g,m){var j=0,h=e(".tile").not(".void"),f=h.length,k,l;for(;j<f;j++){k=e(h[j]);l=k.data("pos");if(l.x==g&&l.y==m){return k}}return null},hasAdjacent:function(i,f){var j=e(this),h=j.data("options"),k=i.data("pos"),g;if(h.SELECT_MODE==1){if(f){return(j.palabrejas("getTile",(k.x-1),k.y)!=null||j.palabrejas("getTile",(k.x+1),k.y)!=null)}else{return(j.palabrejas("getTile",k.x,(k.y-1))!=null||j.palabrejas("getTile",k.x,(k.y+1))!=null)}}else{if(f){return(j.palabrejas("getTile",k.x,(k.y-1))!=null||j.palabrejas("getTile",k.x,(k.y+1))!=null)}else{return(j.palabrejas("getTile",(k.x-1),k.y)!=null||j.palabrejas("getTile",(k.x+1),k.y)!=null)}}}};e.fn.palabrejas=function(f){if(d[f]){return d[f].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof f==="object"||!f){return d.init.apply(this,arguments)}else{e.error("Method "+f+" does not exist on jQuery.modal")}}}})(jQuery);